**核心适配**
- `Agent/core/adapter/llm_adapter.py:35` 适配器入口 `LLMAdapter.complete`，把各厂商流式迭代器收敛为统一的 `NormalizedMessage`。
- `Agent/core/adapter/llm_adapter.py:55` `KimiAdapter.complete` 支持“流式/非流式”两条路径，统一补齐 `provider/tool_schemas/raw`。
- `Agent/core/adapter/llm_adapter.py:81` 非流式归一 `_normalize_non_stream_response`，把 `choices[0].message/tool_calls` 转为私有格式。

**流式标准化**
- `Agent/core/stream/stream_processor.py:20` 定义 `NormalizedMessage`/`NormalizedToolCall` 的私有统一格式。
- `Agent/core/stream/stream_processor.py:48` `StreamProcessor.collect` 聚合 `delta.content/reasoning/tool_calls`、拼接 arguments 分片、兜底 JSON 解析失败，并生成最终规范消息。
- `Agent/core/stream/stream_processor.py:132` 将原始片段保存在 `raw={"chunks":[...]}`，为用量兜底与调试留痕。

**客户端（厂商适配）**
- `Agent/core/llm/client.py:51` `BaseLLMClient` 约定 `stream_chat`/可选 `create_chat_completion`。
- `Agent/core/llm/client.py:101` `MoonshotLLMClient.stream_chat` 输出 OpenAI/Moonshot 风格的流式 `choices[*].delta`，透传 `tools/response_format`。
- `Agent/core/llm/client.py:242` `GLMLLMClient.stream_chat` 同形态的流式增量与用量片段。
- `Agent/core/llm/client.py:379` `BailianLLMClient.stream_chat` 百炼模型的兼容实现。
- 非流式接口：`Agent/core/llm/client.py:182`（Moonshot）、`Agent/core/llm/client.py:313`（GLM）、`Agent/core/llm/client.py:452`（Bailian）。

**服务层集成**
- `Agent/ui/service.py:99` `create_llm_client` 基于环境与偏好选择厂商客户端，并返回 `provider_name`。
- `Agent/ui/service.py:309` `KimiAdapter(...)` 在服务层统一包装成适配器；规划与审查复用同一接口。
- `Agent/ui/service.py:502` `get_tool_schemas` 生成工具定义，作为 `tools` 传入适配层与客户端。
- `Agent/ui/service.py:514` 构造 `CodeReviewAgent`，下游消费 `NormalizedMessage` 与工具事件。

**消费位置（审查 Agent）**
- `Agent/agents/code_reviewer.py:109` 调用 `adapter.complete(...)` 获取标准化回复与工具请求。
- `Agent/agents/code_reviewer.py:152` 读取 `content/tool_calls/finish_reason` 驱动工具执行或结束循环。
- `Agent/agents/code_reviewer.py:293` `_extract_usage` 从 `message.usage` 或 `raw.chunks[*].usage` 兜底提取用量。

**规划链路（也复用适配层）**
- `Agent/agents/planning_agent.py:55` 规划 Agent 通过适配器拿到规划回复（支持流式），随后解析 JSON。
- `Agent/agents/planning_agent.py:77` 解析 `content` 为结构化计划，失败时做降级与错误记录。

**相关文档与 UI**
- 设计说明：`etc/LLM适配层怎么接.md:1` 描述统一格式、接入新厂商的约定与扩展点。
- UI 接口：`Agent/ui/api.py:1` 为前端暴露入口（列出可用模型与工具；不直接处理适配逻辑）。

**不属于适配层但常被混淆**
- Diff 感知层：`DIFF/diff_collector.py:78` 仅负责 git/diff→审查单元的构建，与 LLM 适配独立。

总体上，适配层的核心代码在 `Agent/core/adapter/llm_adapter.py` 和 `Agent/core/stream/stream_processor.py`，其上下游分别由 `Agent/core/llm/client.py` 提供厂商客户端实现、`Agent/ui/service.py` 完成创建与注入，最终被 `CodeReviewAgent` 和 `PlanningAgent` 消费。